#pragma config(Motor,  port2,           backRightMotor, tmotorVex269_MC29, openLoop)
#pragma config(Motor,  port3,           frontLeftMotor, tmotorVex269_MC29, openLoop)
#pragma config(Motor,  port4,           frontRightMotor, tmotorVex269_MC29, openLoop)
#pragma config(Motor,  port5,           backLeftMotor, tmotorVex269_MC29, openLoop)
#pragma config(Motor,  port6,           rightFlywheel, tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port7,           leftFlywheel,  tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port8,           intakeMotor,   tmotorVex393_MC29, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#pragma platform(VEX)

//Competition Control and Duration Settings
#pragma competitionControl(Competition)
#pragma autonomousDuration(20)
#pragma userControlDuration(120)

#include "Vex_Competition_Includes.c"   //Main competition background code...do not modify!



float launcherSpeed = 127;
bool launcherRunning = false;

void runLauncher(int speed){ //starts flywheels at speed "speed"
	if(speed > 127)
		speed = 127;
	if(speed < 127)
		speed = -127;
	motor[rightFlywheel] = speed;
	motor[leftFlywheel] = speed;
}

task motor_control{
	while(true){
		if((vexRT[Btn5U] == 0) == (vexRT[Btn6U] == 0)){ //normal driving controls
			motor[frontLeftMotor] = vexRT[Ch2];
			motor[backRightMotor] = vexRT[Ch2];
			motor[frontRightMotor] = vexRT[Ch3];
			motor[backLeftMotor] = vexRT[Ch3];
			} else if(vexRT[Btn5U] == 1) { //rotate left (right?)
			motor[frontLeftMotor] = 127;
			motor[backRightMotor] = 127;
			motor[frontRightMotor] = 127;
			motor[backLeftMotor] = 127;
			wait1Msec(40);
			} else{ //rotate right (left?)
			motor[frontLeftMotor] = -127;
			motor[backRightMotor] = -127;
			motor[frontRightMotor] = -127;
			motor[backLeftMotor] = -127;
			wait1Msec(40);
		}
		wait1Msec(10);
		EndTimeSlice();
	}
}

task launcher_toggle_listener(){ //controls flywheels
	while(true){
		if(vexRT[btn8D] == 1  && !launcherRunning) {
			runLauncher(launcherSpeed);
			launcherRunning = !launcherRunning;
			} else if(vexRT[btn8D] == 1 && launcherRunning){
			runLauncher(0);
			launcherRunning = !launcherRunning;
		}
		while(vexRT[btn8D] == 1)
			wait1Msec(50);
		wait1Msec(50);
		EndTimeSlice();
	}
}

task launcher_speed_control(){ //changes speed of flywheels
	while(true){
		if(vexRT[Btn8L] == 1 && vexRT[Btn8R] == 0){
			launcherSpeed -= 12.7;
			} else if(vexRT[Btn8L] == 0 && vexRT[Btn8R] == 1){
			launcherSpeed += 12.7;
		}
		if(launcherRunning)
			runLauncher(launcherSpeed);
		while(vexRT[Btn8L] == 1 || vexRT[Btn8R] == 1)
			wait1Msec(20);
		wait1Msec(50);
		EndTimeSlice();
	}
}

task intake_control(){ //controls intakes
	while(true){
		if(vexRT[Btn7U] == 1){
			motor[intakeMotor] = 127;
			} else if(vexRT[Btn7D] == 1){
			motor[intakeMotor] = -127;
			} else{
			motor[intakeMotor] = 0; }
		wait1Msec(50);
		EndTimeSlice();
	}
}





/////////////////////////////////////////////////////////////////////////////////////////
//
//                          Pre-Autonomous Functions
//
// You may want to perform some actions before the competition starts. Do them in the
// following function.
//
/////////////////////////////////////////////////////////////////////////////////////////

void pre_auton()
{
	// Set bStopTasksBetweenModes to false if you want to keep user created tasks running between
	// Autonomous and Tele-Op modes. You will need to manage all user created tasks if set to false.
	bStopTasksBetweenModes = true;

	// All activities that occur before the competition starts
	// Example: clearing encoders, setting servo positions, ...

}

/////////////////////////////////////////////////////////////////////////////////////////
//
//                                 Autonomous Task
//
// This task is used to control your robot during the autonomous phase of a VEX Competition.
// You must modify the code to add your own robot specific commands here.
//
/////////////////////////////////////////////////////////////////////////////////////////

task autonomous()
{
	// .....................................................................................
	// Insert user code here.
	// .....................................................................................
	runLauncher(127);
	launcherRunning = true;
	wait(3);
	motor[intakeMotor] = 50;
	wait(10);
	motor[intakeMotor] = 0;
	runLauncher(0);
	launcherRunning = false;
}

/////////////////////////////////////////////////////////////////////////////////////////
//
//                                 User Control Task
//
// This task is used to control your robot during the user control phase of a VEX Competition.
// You must modify the code to add your own robot specific commands here.
//
/////////////////////////////////////////////////////////////////////////////////////////

task usercontrol()
{

	startTask(launcher_toggle_listener);
	startTask(launcher_speed_control);
	startTask(motor_control);
	startTask(intake_control);
	// User control code here, inside the loop

	while (true)
	{
		// This is the main execution loop for the user control program. Each time through the loop
		// your program should update motor + servo values based on feedback from the joysticks.

		// .....................................................................................
		// Insert user code here. This is where you use the joystick values to update your motors, etc.
		// .....................................................................................
		wait1Msec(100);
	}
}
